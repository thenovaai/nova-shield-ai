#!/bin/bash

# Nova Shield - Wrapper Script
# Handles nova command and special commands like update

cd "$HOME/.nova-shield"

# Check if this is an update command
if [[ "$1" == "update" ]]; then
    echo "ğŸ”„ Updating Nova Shield..."
    echo "=========================="
    
    # Check if we're in a git repository
    if [ -d ".git" ]; then
        echo "ğŸ“¥ Fetching latest changes from git..."
        git fetch origin main
        
        # Check if there are updates
        LOCAL_COMMIT=$(git rev-parse HEAD)
        REMOTE_COMMIT=$(git rev-parse origin/main)
        
        if [ "$LOCAL_COMMIT" != "$REMOTE_COMMIT" ]; then
            echo "ğŸ”„ Updates available! Building latest version..."
            git pull origin main
            
            # Rebuild Nova
            echo "ğŸ”¨ Building latest Nova Shield..."
            cd codex-rs
            cargo build --release -p codex-tui
            
            if [ -f "target/release/codex-tui" ]; then
                echo "âœ… Nova Shield updated successfully!"
                echo ""
                echo "ğŸ›¡ï¸ Latest version is now ready to use!"
            else
                echo "âŒ Build failed during update"
                exit 1
            fi
        else
            echo "âœ… Nova Shield is already up to date!"
        fi
    else
        echo "âŒ Not a git repository"
        echo "ğŸ’¡ Try reinstalling: curl -fsSL https://raw.githubusercontent.com/thenovaai/nova-shield/main/install-nova.sh | bash"
        exit 1
    fi
else
    # Run the normal Nova Shield binary
    ./codex-rs/target/release/codex-tui "$@"
fi
